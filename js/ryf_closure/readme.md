# 阮一峰closure

- 闭包是核心考点和难点
- 闭包可以帮助外部读取函数内部的变量
- 声明不带上var、let、const，默认提升为全局变量
  - 语言精粹 The Good Parts The bad parts
- 如何介绍闭包
  - 闭包的形成条件
    - 1. 函数嵌套函数（作用域链的嵌套）
      - f2在f1的里面
    - 2. 内部函数访问外部变量
      - f2访问f1的变量n
    - 3. 外部函数返回内部函数
      - f1将f2返回给全局
  - 形成了一个闭包，闭包也叫背包，里面的自由变量不会销毁
  - 执行先后顺序带来的
    - 外部函数出栈时，触发GC清除其局部变量，但由于闭包中的变量还在被引用，所以不会被清除
    - 垃圾回收机制GC
      - 引用计数
      - 标记-清除
      - 标记-整理
  - 闭包可能带来内存的泄漏
  - 内层函数叫闭包函数


- 闭包就是将函数内部和函数外部连接起来的桥梁

## 闭包的用途
- 读取函数内部的变量
- 让这些变量的值始终保持在内存中
- 怎么说明外部函数的自由变量不会销毁？
  - 多次执行闭包函数，可以观察到自由变量的值
  - 垃圾回收机制（引用计数）

## 注意
- 闭包内存消耗比较大，可能会导致内存泄漏
  - 在退出函数之前，将不使用的局部变量全部销毁（置为null，对象可以delete）
  - 手动将闭包变量设为null
- 闭包会在父函数外部，改变父函数内部变量的值
  - 会带来不确定性，**自由变量**
  - **自由**还体现在生命周期